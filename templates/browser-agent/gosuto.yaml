apiVersion: gosuto/v1
metadata:
  name: "{{.AgentName}}"
  template: browser-agent
  description: "Browser automation agent with approval-gated navigation and form interaction."

trust:
  allowedRooms:
    - "{{.AdminRoom}}"
  allowedSenders:
    - "*"
  requireE2EE: false
  adminRoom: "{{.AdminRoom}}"

limits:
  maxRequestsPerMinute: 5
  maxTokensPerRequest: 8192
  maxConcurrentRequests: 1
  maxMonthlyCostUSD: 20.00

capabilities:
  - name: allow-screenshot
    mcp: playwright
    tool: screenshot
    allow: true

  - name: allow-navigate-with-approval
    mcp: playwright
    tool: navigate
    allow: true
    requireApproval: true

  - name: allow-click-with-approval
    mcp: playwright
    tool: click
    allow: true
    requireApproval: true

  - name: deny-form-fill
    mcp: playwright
    tool: fill
    allow: false

  - name: deny-all-other-playwright
    mcp: playwright
    tool: "*"
    allow: false

  - name: deny-all-others
    mcp: "*"
    tool: "*"
    allow: false

approvals:
  enabled: true
  room: "{{.AdminRoom}}"
  approvers:
    - "{{.OperatorMXID}}"
  ttlSeconds: 300

persona:
  systemPrompt: |
    You are a controlled browser automation agent. You capture screenshots and
    navigate web pages ONLY at explicit operator request. Every navigation and
    click requires approval before execution. Never fill forms or submit data
    unless specifically instructed and approved. Describe what you observe
    clearly and wait for instructions.
  llmProvider: anthropic
  model: claude-3-5-sonnet-20241022
  temperature: 0.1

secrets:
  - name: "{{.AgentName}}.anthropic-api-key"
    envVar: ANTHROPIC_API_KEY
    required: true

mcps:
  - name: playwright
    command: npx
    args:
      - "-y"
      - "@playwright/mcp"
      - "--headless"
    autoRestart: true

instructions:
  role: |
    You are a controlled browser automation agent. You only take browser actions
    at explicit operator request. Every navigation and click requires approval
    before execution. Never take autonomous actions â€” always wait for explicit
    instructions from the operator.
  workflow:
    - trigger: "operator message requesting a screenshot or page observation"
      action: "Use playwright screenshot tool to capture the current page state and describe what you see."
    - trigger: "operator message requesting navigation to a URL"
      action: "Request approval via the approval workflow, then navigate to the URL and report what was found."
    - trigger: "operator message requesting a click action"
      action: "Request approval, then perform the approved click action and report the outcome."
  context:
    user: "The user is the sole operator and approver. All browser actions require their explicit authorisation."
    peers: []
